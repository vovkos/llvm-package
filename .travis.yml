dist:     trusty
sudo:     required
language: cpp

os:
    - linux
    - osx

compiler:
    - gcc
    - clang

env:
    global:
        - LLVM_VERSION=3.4.2
        - TAR_COMPRESSION=bzip2

    matrix:
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release
        - TARGET_CPU=x86 BUILD_CONFIGURATION=Debug
        - TARGET_CPU=x86 BUILD_CONFIGURATION=Release

matrix:
    exclude:
        -   os:       osx
            compiler: gcc

        -   os:  osx
            env: TARGET_CPU=x86 BUILD_CONFIGURATION=Debug

        -   os:  osx
            env: TARGET_CPU=x86 BUILD_CONFIGURATION=Release

install:
    - source set-env-vars.sh
    - source install.sh

script:
    - echo LLVM_CMAKE_FLAGS=$LLVM_CMAKE_FLAGS
    - echo LLVM_CPU_COUNT=$LLVM_CPU_COUNT

    - mkdir llvm/build
    - pushd llvm/build
    - cmake .. $LLVM_CMAKE_FLAGS
    - make -j $LLVM_CPU_COUNT
    - make install
    - popd

    - echo CLANG_CMAKE_FLAGS=$CLANG_CMAKE_FLAGS
    - echo CLANG_CPU_COUNT=$CLANG_CPU_COUNT

    - mkdir clang/build
    - pushd clang/build
    - cmake .. $CLANG_CMAKE_FLAGS
    - make -j $CLANG_CPU_COUNT
    - make install
    - popd

    - travis_wait tar --${TAR_COMPRESSION} -cvf $LLVM_RELEASE_FILE $LLVM_RELEASE_NAME
    - travis_wait tar --${TAR_COMPRESSION} -cvf $CLANG_RELEASE_FILE $CLANG_RELEASE_NAME

deploy:
    provider:     releases
    skip_cleanup: true
    overwrite:    true

    file:
        - $LLVM_RELEASE_FILE
        - $CLANG_RELEASE_FILE

    api_key:
        secure:   lBqOSkQjhEn91Vkk0IWYEOgeiixph+lC1cnu+ng5ZIcxYD/FRSmv60qrB8hG/rex4O1LSAvJYx0WP2dIJymI5QmUZqwK2nB2m24b1vytvcgmY5oFbxHWUdV/ZgIakkhJqXoMEcVSUUoukpdfOwgnsCMClAoHqhghbLqFj8nz6FAyu8Q/JKzLR7d99Nuj6TSjLPazNjhamcOn6nKQEPW5Ut2Au8n+cGlL6IQWq477Q5uXFK0VL6gZP+TuEVpgf628RBmnDiHyrrnTL9SEw279/GES91h5P/S+MSBw5pD6oOzc5TIeDwb0j+UwAnJSQm/K9fHxWXK2+G6sVJ90zOs2vE27l7oqfzjUcIzy+Zo2bO6U9+77vHklGIU+JlW5tMLH1vG0HQg9YN8cL1amdFJDxh/rDOhs8pqj5nMLFAZ5jwcZsG3UPFBOs4cP8daGYi6EqCpbIFRfZ0thpPiLUEjvwe0FqLiuh+FWp2q5+5JP+WvyRyWrE3krnakmYGbBknMbq1yyIKjwEU42sktAIMkvRzfQs4OiijCv5ZaA7oDK6oSPUhlRkmvZytqIqICubRRRsj76QPAUpXCdTgg1VvGJp+EELX1WBZhRrrKWezu+bTRBLBAIy44RFTHnt+bC9XjEWLtzZFVupsoXHgGmnfI3iiSAvQccJaSz5FAcn/krmUc=

    on:
        tags:     true
